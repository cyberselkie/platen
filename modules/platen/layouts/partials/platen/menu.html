{{- $context            := . -}}

<nav>
{{ partial "platen/menu/brand" $context }}
{{ partial "platen/features/search/menu" $context }}
{{ if $context.Site.IsMultiLingual }}
  {{ partial "platen/menu/languages" . }}
{{ end }}

{{ partial "platen/menu/feature" (dict "Context" $context "Position" "BeforeInjection") }}

{{ partial "platen/inject/menu-before" $context }}

{{ partial "platen/menu/feature" (dict "Context" $context "Position" "BeforeHugoConfig") }}

{{ partial "platen/menu/hugo" $context.Site.Menus.before }}

{{ partial "platen/menu/feature" (dict "Context" $context "Position" "BeforeRootSection") }}

{{ partial "platen/menu/filetree" $context }}

{{ partial "platen/menu/feature" (dict "Context" $context "Position" "AfterRootSection") }}

{{ partial "platen/menu/hugo" $context.Site.Menus.after }}

{{ partial "platen/menu/feature" (dict "Context" $context "Position" "AfterHugoConfig") }}

{{ partial "platen/inject/menu-after" $context }}

{{ partial "platen/menu/feature" (dict "Context" $context "Position" "AfterInjection") }}
</nav>

<!-- Restore menu position as soon as possible to avoid flickering -->
{{ $script := resources.Get "scripts/platen/menu-reset.js" | resources.Minify }}
{{ with $script.Content }}
  <script>{{ . | safeJS }}</script>
{{ end }}
