{{/*
    Docs.ShortCode: art
*/}}
{{- $input := . -}}

{{/* Process input parameters */}}
{{- $src            := default ($input.Get 0) ($input.Get "src")            -}}
{{- $alt            := default ($input.Get 1) ($input.Get "alt")            -}}
{{- $class          := default ($input.Get 2) ($input.Get "class")          -}}
{{- $class           = default "full"         $class                        -}}
{{- $contentWarning := default ($input.Get 3) ($input.Get "contentWarning") -}}
{{- $caption        := default nil            $input.Inner                  -}}

{{/* Handle missing alt text */}}
{{- $missingAltText := eq nil $alt                      -}}
{{- if $missingAltText -}}
  {{- $handlerParams := dict "Input" $input 
                             "Suffix" "\n\tMake sure to specify alt text with the 'alt' parameter."
  -}}
  {{- partial "platen/handlers/missingAltText" $handlerParams -}}
{{- end -}}

{{/* Define classes for easy reference elsewhere */}}
{{- $artClass := "platen-art"             -}}
{{- $cwClass  := "platen-content-warning" -}}


{{/* Define the attribute list for the figure element */}}
{{- $figureAttributes := slice -}}
{{- $figureClass      := slice $artClass -}}
{{- with $contentWarning -}}
  {{- $figureClass = $figureClass | append $cwClass -}}
{{- end -}}
{{- with $class -}}
  {{- $figureClass = $figureClass | append $class -}}
{{- end -}}
{{- $figureClass      = delimit $figureClass " "                                      -}}
{{- $figureAttributes = $figureAttributes | append (printf `class="%s"` $figureClass) -}}
{{- $figureAttributes = partial "platen/utils/getSafeAttributes" $figureAttributes    -}}

{{/* Define the attibute list for the img element */}}
{{- $imageAttributes := slice                                              -}}
{{- $imageAttributes  = $imageAttributes | append (printf `src="%s"` $src) -}}
{{- $imageAttributes  = $imageAttributes | append (printf `alt="%s"` $alt) -}}
{{- with $contentWarning -}}
  {{- $imageAttributes = $imageAttributes | append (printf `class="%s"` $cwClass) -}}
{{- end -}}
{{- $imageAttributes = partial "platen/utils/getSafeAttributes" $imageAttributes -}}

{{/* Define the attribute list for the button element */}}
{{- $cwButtonAttributes := slice                                                         -}}
{{- $cwButtonAttributes  = $cwButtonAttributes | append `type="button"`                  -}}
{{- $cwButtonAttributes  = $cwButtonAttributes | append `class="platen-content-warning"` -}}
{{- $cwButtonAttributes  = partial "platen/utils/getSafeAttributes" $cwButtonAttributes  -}}

{{/* Render */}}
<figure {{ $figureAttributes }}>
  <img {{ $imageAttributes }}>
  {{ with $caption -}}
    <figcaption>{{ $caption | markdownify }}</figcaption>
  {{- end }}
  {{ with $contentWarning -}}
    <button {{ $cwButtonAttributes }}>
      {{ $contentWarning | markdownify }}
    </button>
  {{- end }}
</figure>
