# yaml-language-server: $schema=https://json-schema.org/draft/2020-12/schema
$schema: https://json-schema.org/draft/2020-12/schema
$id: /schemas/Platen/Site/Features/Katex.schema.yaml
title: Mermaid Diagrams
description: Settings that control the site's Mermaid diagrams rendering feature.
schematize:
  details: |
    These settings control Platen's Mermaid diagrams rendering feature. When this feature is
    enabled, you can use [Mermaid][01] to create diagrams in your content with `mermaid`
    [codeblock rendering hook][02].

    With Mermaid, you can create numerous diagrams including flowcharts, pie  charts, and sequence
    diagrams.

    <!-- Reference Links -->
    [01]: https://mermaid-js.github.io/mermaid/
    [02]: /modules/platen/renderers/mermaid
type: object
properties:
  Enabled:
    title: Enable Mermaid
    description: Choose whether Mermaid diagram rendering is available for the site.
    schematize:
      details: |
        Choose whether the site renders Mermaid diagrams. The default is `true`.
      weight: 1
    type: boolean
    default: true
  Version:
    title: Mermaid Version
    description: Specify the version of Mermaid to load when needed.
    schematize:
      details: |
        Specifies the version of Mermaid to load when needed. The Mermaid feature retrieves the
        style and script modules for Mermaid from a CDN at build time. This value is used to
        determine which version to bundle with the site and use for auto-rendering.

        You can set this value to any valid released version of Mermaid. The default is `0.16.4`.
      weight: 2
    type: string
    default: 0.16.4
  Container:
    title: Container Element
    description: Specify the container element for Mermaid diagrams.
    schematize:
      details: |
        Specify the container element for Mermaid diagrams to render inside. By default, diagrams
        are rendered in a [sref:`<pre>`] element. This setting can be overridden on a per-diagram
        basis with the `container` [attribute][01] or [YAML option][02].

        Switching this value to `div` or `aside` will remove the default styling for `pre`. The
        [sref:`<aside>`] element is useful for semantically indicating that the diagram is only
        indirectly related to the rest of the content.

        [sref:`<pre>`]: mdn.html.element:pre
        [01]: /modules/platen/renderers/mermaid
        [02]: /modules/platen/renderers/mermaid
      weight: 3
    type: string
    default: pre
  Partials:
    title: Feature Partials
    description: Define a map of partials for Platen to inject as needed.
    schematize:
      details: |
        Define a map of partials for Platen to inject as needed. These partials are only
        injected when [sref:`Enabled`] is set to `true`.

        <!-- Reference Links -->
        [sref:`Enabled`]: Platen.Site.Features.Mermaid.Enabled
      weight: 100
      skipSchemaRender: true
    type: object
    properties:
      Header:
        title: Header Partial
        description: Injects a partial into the HTML header.
        schematize:
          details: |
            If specified, this partial is processed in the HTML header with the current page's
            context. The default value is `platen/features/mermaid/header`. You can overwrite
            this value, replacing it with another partial entirely, or you can add the same file to
            your own theme or site, effectively replacing it.

            The default partial pulls the Mermaid style and library modules from a CDN if the page
            content includes [any codeblocks with the `mermaid` language ID][01].

            With the modules loaded, the page will automatically render any valid Mermaid markup on
            page, displaying the diagrams.

            <!-- Reference Links -->
            [01]: /modules/platen/renderers/mermaid
        type: string
        default: platen/features/mermaid/header
      Renderers:
        title: Renderer Partials
        description: Registers one or more partials that act as render hooks.
        type: object
        schematize:
          skipSchemaRender: true
          details: |
            Defines a map of partials to use as Markdown render hooks. Like all partials, these are
            only processed when [sref:`Enabled`] is set to `true`.

            Supported renderer partials include:

            - `Codeblock`, processed for fenced code blocks with a language ID
            - `Heading`, processed for headings
            - `Image`, processed for image links
            - `Link`, processed for non-image links

            In all cases, all renderer partials for enabled features are checked one after the other
            unless they return a render string. Only the first applicable partial that returns a
            render string is processed and rendered.

            <!-- Reference Links -->
            [sref:`Enabled`]: Platen.Site.Features.Mermaid.Enabled
        properties:
          Codeblock:
            title: Codeblock Render Hook Partial
            description: Adds a partial to call when processing the codeblock render hook.
            schematize:
              details: |
                Adds support for Mermaid markup rendering for content. This render hook is only
                processed when the language ID for a codeblock is `mermaid`.

                It registers the current page as having Mermaid, which ensures the library and style
                modules are loaded for automatic rendering.

                It renders the codeblock's definition inside a `pre` element by default. With the
                `class` attribute, it adds the specified classes to the element. With the `id`
                attribute, it adds an ID to the element, making it easier to link to.

                It supports the new initialize directives for Mermaid, allowing you to override
                Mermaid's configuration on a per-diagram basis.

                It has handling for rendering the diagram inside a `figure` element as well, if the
                definition includes the `<!-- Mermaid -->` separator between the figure's options and
                the Mermaid syntax.

                For more information about authoring Mermaid diagrams in Platen, see
                [Mermaid Diagrams][01] in the reference documentation.

                This value defaults to `platen/features/mermaid/codeblock`. You can replace it with a
                different value, defining a new partial, or override the existing partial by creating
                the file `layouts/partials/platen/features/mermaid/codeblock.html` in your own site or
                module.

                For more information about defining codeblock render hook partials, see
                [Defining a Codeblock Render Hook Partial][02] in the [Theme Guide][03].

                <!-- Reference Links -->
                [01]: /modules/platen/renderers/mermaid
                [02]: /styling
                [03]: /styling
            type: string
            default: platen/features/mermaid/codeblock
